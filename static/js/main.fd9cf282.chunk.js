(this["webpackJsonptime-tracker"]=this["webpackJsonptime-tracker"]||[]).push([[0],{23:function(e,t,n){e.exports=n(58)},57:function(e,t,n){},58:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(20),o=n.n(c),s=n(1),i=n(4),l=n(2),u=n.n(l),m=n(21),f=n.n(m),d=n(22),p=function(e){return function(t){return e.name===t.name&&e.project===t.project}};function b(){var e=Object(a.useState)(!1),t=Object(s.a)(e,2),n=t[0],r=t[1];return Object(a.useEffect)((function(){return function(){return r(!0)}}),[]),n}function h(){var e=Object(a.useState)(""),t=Object(s.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)(!0),i=Object(s.a)(o,2),l=i[0],u=i[1],m=r.a.createElement("div",{className:"error-message ".concat(l?"hidden":"")},n);return Object(a.useEffect)((function(){if(n){u(!1);var e=setTimeout((function(){u(!0),c(""),e=null}),3200);return function(){e&&clearTimeout(e)}}}),[n]),[m,c]}var k="https://mock.adapter.com",v=new f.a(u.a,{delayResponse:180});function E(e){localStorage.setItem("tasks",JSON.stringify(e)),function(e){var t=new Date;t.setFullYear(t.getFullYear()+6),document.cookie="tasks=".concat(escape(JSON.stringify(e)),";expires=").concat(t.toGMTString())}(e)}var g=localStorage.getItem("tasks")?JSON.parse(localStorage.getItem("tasks")):function(){var e=document.cookie.match(/tasks=([^;]+)/),t=e&&unescape(e[1]);return t&&JSON.parse(t)}()||[];v.onGet("".concat(k,"/tasks/")).reply((function(e){return[200,g.slice()]})),v.onPost("".concat(k,"/tasks/")).reply((function(e){var t=JSON.parse(e.data);return g.some(p(t))?[403,{}]:(g.push(t),E(g),[200,{}])})),v.onPatch("".concat(k,"/tasks/")).reply((function(e){var t=JSON.parse(e.data),n=t.old_task,a=t.new_task,r=g.find(p(n));return!p(n)(a)&&g.some(p(a))?[405,{}]:void 0===r?[403,{}]:(Object.assign(r,a),E(g),[200,{}])})),v.onPost("".concat(k,"/delete-task/")).reply((function(e){var t=JSON.parse(e.data);return g.some(p(t))?(E(g=g.filter((function(e){return!p(t)(e)}))),[200,{}]):[403,{}]})),v.onPost("".concat(k,"/import-tasks/")).reply((function(e){var t=JSON.parse(e.data);return E(g=g.filter((function(e){return!t.some(p(e))})).concat(t)),[200,{}]}));var O=Boolean(Object({NODE_ENV:"production",PUBLIC_URL:"/react-time-tracker"}).REACT_APP_API)?Object({NODE_ENV:"production",PUBLIC_URL:"/react-time-tracker"}).REACT_APP_API.replace(/\/^/,""):k;function j(e){var t=e.getBoundingClientRect(),n=e.width=t.width,a=e.height=t.height,r=e.getContext("2d");return r.fillStyle="white",[r,n,a]}function y(e,t,n,a){var r=-Math.PI/2,c=2*Math.PI*a+r,o=[t/2,n/2];e.globalAlpha=.4,e.clearRect(0,0,t,n),e.beginPath(),e.moveTo.apply(e,o),e.arc.apply(e,o.concat([t/2,r,c])),e.fill(),e.globalAlpha=1,e.globalCompositeOperation="destination-out",e.beginPath(),e.moveTo.apply(e,o),e.arc.apply(e,o.concat([t/2-4,0,2*Math.PI])),e.fill(),e.globalCompositeOperation="source-over"}var S=function(e){var t=e.startingSeconds,n=e.isTimerRunning,c=void 0!==n&&n,o=e.children,i=Object(a.useRef)(null);return Object(a.useEffect)((function(){if(i.current&&void 0===Object({NODE_ENV:"production",PUBLIC_URL:"/react-time-tracker"}).JEST_WORKER_ID){if(c)return function(e,t){var n=!0,a=j(e),r=Object(s.a)(a,3),c=r[0],o=r[1],i=r[2];requestAnimationFrame((function e(t){n&&requestAnimationFrame(e);var a=(t-l)/1e3;l=t,y(c,o,i,u+=a/60)}));var l=performance.now(),u=t%60/60;return function(){n=!1}}(i.current,t);!function(e,t){var n=j(e),a=Object(s.a)(n,3);y(a[0],a[1],a[2],t%60/60)}(i.current,t)}}),[c,t]),r.a.createElement("div",{className:"task-timer-container"},r.a.createElement("canvas",{ref:i,className:"task-timer"}),o)};function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){Object(i.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var T=function(e){return String(100+e%100).substr(1)},C=function(e,t){switch(t.type){case"START":return N({},e,{isRunning:!0,millisecondsOnStart:e.milliseconds,timestampOnStart:Date.now(),millisecondsUntillNextMinute:6e4-e.milliseconds%6e4});case"STOP":return N({},e,{isRunning:!1});case"TICK":var n=e.millisecondsOnStart+Date.now()-e.timestampOnStart;return N({},e,{milliseconds:n,millisecondsUntillNextMinute:6e4-n%6e4});case"UPDATE":return N({},e,{milliseconds:1e3*t.seconds});default:return e}};var P=function(e){var t=e.task,n=e.editTask,c=e.updateTasks,o=e.selectProject,i=e.tasks,l=e.onPlayStart,m=Object(a.useReducer)(C,{isRunning:!1,milliseconds:1e3*t.seconds,millisecondsOnStart:null,timestampOnStart:null,millisecondsUntillNextMinute:null}),f=Object(s.a)(m,2),d=f[0],k=f[1],v=Math.floor(d.milliseconds/60/1e3)%60,E=Math.floor(d.milliseconds/60/1e3/60),g=h(),j=Object(s.a)(g,2),y=j[0],w=j[1],P=b();Object(a.useEffect)((function(){var e=Math.floor(d.milliseconds/1e3);d.isRunning||t.seconds===e||k({type:"UPDATE",seconds:t.seconds})}),[d.isRunning,t.seconds,d.milliseconds]);var _=Object(a.useCallback)((function(e){var n=d.millisecondsOnStart+Date.now()-d.timestampOnStart,a=Math.floor(n/1e3);u.a.patch("".concat(O,"/tasks/"),{old_task:{name:t.name,project:t.project},new_task:N({},t,{seconds:a})}).then((function(t){e&&e(a)})).catch((function(e){e.response&&405===e.response.status?w("Somehow, we tried to change this task name to an invalid one."):e.response&&403===e.response.status?w("Invalid request: this task doesn't exist anymore."):(w("Error connecting with the server."),console.error(e))}))}),[t,d.millisecondsOnStart,d.timestampOnStart,w]);function R(e){_((function(n){c((function(e){return e.map((function(e){return e.name===t.name&&e.project===t.project?N({},t,{seconds:n}):e}))})),P||(k({type:"STOP"}),e&&e())}))}return Object(a.useEffect)((function(){if(d.isRunning){var e=setTimeout((function(){return k({type:"TICK"})}),d.millisecondsUntillNextMinute);return function(){return clearTimeout(e)}}}),[d.isRunning,d.millisecondsUntillNextMinute]),Object(a.useEffect)((function(){var e=Math.floor(d.milliseconds/1e3);d.isRunning&&e!==t.seconds&&e%60===0&&_()}),[d.isRunning,_,d.milliseconds,t.seconds]),Object(a.useEffect)((function(){if(d.isRunning)return window.onbeforeunload=function(e){return"There's a task running. You'll loose the timer progress."},function(){return window.onbeforeunload=void 0}}),[d.isRunning]),r.a.createElement("div",{draggable:!0,onDragStart:function(e){e.dataTransfer.setData("text/plain","".concat(t.name,"/").concat(t.project))},onDragOver:function(e){return e.preventDefault()},onDrop:function(e){e.preventDefault();var n=e.dataTransfer.getData("text").split("/"),a=Object(s.a)(n,2),r=a[0],o=a[1];r&&o&&function(e){var n=i.findIndex(p(e)),a=i.findIndex(p(t));if(-1!==n&&-1!==a){var r;r=n<a?a>=i.length-1?t.timestamp-9e3:i[a+1].timestamp:a>0?i[a-1].timestamp:Date.now();var o=Math.floor((t.timestamp+r)/2),s=i.find(p(e));u.a.patch("".concat(O,"/tasks/"),{old_task:e,new_task:N({},s,{timestamp:o})}).then((function(e){c()})).catch((function(e){e.response&&405===e.response.status?w("Somehow, we tried to change this task name to an invalid one."):e.response&&403===e.response.status?w("Invalid request: This task doesn't exist anymore."):(w("Error connecting with the server."),console.error(e))}))}}({name:r,project:o})},className:"task",style:{"--task-color":t.color}},r.a.createElement("div",{className:"task-head"},r.a.createElement(S,{key:v,startingSeconds:Math.floor(d.milliseconds/1e3),isTimerRunning:d.isRunning},d.isRunning?r.a.createElement("button",{className:"stop",onClick:function(){return R()}},r.a.createElement("img",{src:"".concat("/react-time-tracker","/baseline_pause_white_24dp.png"),alt:"Stop timer",title:"Stop timer"})):r.a.createElement("button",{className:"start",onClick:function(){k({type:"START"}),l()}},r.a.createElement("img",{src:"".concat("/react-time-tracker","/baseline_play_arrow_white_24dp.png"),alt:"Start timer",title:"Start timer"})))),r.a.createElement("div",{className:"task-body"},r.a.createElement("div",{className:"float-left"},r.a.createElement("h3",null,t.name),T(E),":",T(v)," - ",r.a.createElement("span",{className:"clickable",onClick:function(){return o(t.project)}},t.project),y),r.a.createElement("div",{className:"task-foot"},r.a.createElement("button",{className:"edit",onClick:function(){d.isRunning?R(n):n()}},"Edit"))))};function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){Object(i.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var I=function(e){return function(t){return e(t.target.value)}};var D=function(e){var t=e.task,n=e.cancelEdition,c=e.updateTasks,o=Object(a.useState)(t.name),i=Object(s.a)(o,2),l=i[0],m=i[1],f=Object(a.useState)(Math.floor(t.seconds/60)%60),d=Object(s.a)(f,2),p=d[0],k=d[1],v=Object(a.useState)(Math.floor(t.seconds/60/60)),E=Object(s.a)(v,2),g=E[0],j=E[1],y=b(),w=Object(a.useState)(!1),N=Object(s.a)(w,2),T=N[0],C=N[1],P=h(),_=Object(s.a)(P,2),D=_[0],x=_[1];function A(){u.a.patch("".concat(O,"/tasks/"),{old_task:{name:t.name,project:t.project},new_task:R({},t,{name:l,seconds:60*g*60+60*p})}).then((function(e){y||n(),c()})).catch((function(e){e.response&&405===e.response.status?x("A task with that name already exists."):e.response&&403===e.response.status?x("Invalid request: this task doesn't exist anymore!"):(x("Error connecting with the server."),console.error(e))}))}var M=function(e){return r.a.createElement("button",{className:"confirm",onClick:A,disabled:!l},e)};return r.a.createElement("div",{className:"task",style:{"--task-color":t.color}},r.a.createElement("div",{className:"task-head"},r.a.createElement(S,{seconds:t.seconds},M(r.a.createElement("img",{src:"".concat("/react-time-tracker","/baseline_edit_white_24dp.png"),alt:"Edit task",title:"Edit task"})))),r.a.createElement("div",{className:"task-body"},r.a.createElement("h3",null,r.a.createElement("input",{type:"text",placeholder:"Task name",value:l,onChange:I(m)})),r.a.createElement("input",{type:"number",min:0,value:g,onChange:I(j)}),":",r.a.createElement("input",{type:"number",min:0,max:60,value:p,onChange:I(k)}),D),r.a.createElement("div",{className:"task-foot"},M("Edit task"),r.a.createElement("button",{className:"cancel",onClick:n},"Cancel"),r.a.createElement("button",{className:"delete",onClick:function(){T?u.a.post("".concat(O,"/delete-task/"),{name:t.name,project:t.project}).then((function(e){y||n(),c((function(e){return e.filter((function(e){return t.name!==e.name||t.project!==e.project}))}))})).catch((function(e){e.response&&403===e.response.status?x("Invalid request: the task was already deleted!"):(x("Error connecting with the server."),console.error(e))})):C(!0)}},T?"Delete?":"Delete")))};var x=function(e){var t=e.task,n=e.updateTasks,c=e.selectProject,o=e.tasks,i=Object(a.useState)(!1),l=Object(s.a)(i,2),u=l[0],m=l[1],f=Object(a.useState)(!Boolean(localStorage.getItem("hasShownATask"))),d=Object(s.a)(f,2),p=d[0],b=d[1];Object(a.useEffect)((function(){p||localStorage.setItem("hasShownATask","1")}),[p]);var h=o?o.length:null;return Object(a.useEffect)((function(){null!==h&&h>1&&b(!1)}),[h]),u?r.a.createElement(D,{task:t,cancelEdition:function(){return m(!1)},updateTasks:n}):r.a.createElement(r.a.Fragment,null,p?r.a.createElement("div",{className:"first-time-notice",style:{"--task-color":t.color}},"Now you can hit play to begin tracking the time you spend on"," ",r.a.createElement("b",null,t.name),"."):"",r.a.createElement(P,{task:t,editTask:function(){b(!1),m(!0)},onPlayStart:function(){b(!1)},updateTasks:n,selectProject:c,tasks:o}))},A=function(e){return function(t){return e(t.target.value)}},M=["#6d7502","#1fad13","#c60d8f","#5577ff","#ff3344"];var U=function(e){var t=e.projects,n=e.projectColors,c=e.onCreate,o=e.onCancel,i=e.isFirstTime,l=Object(a.useState)(""),m=Object(s.a)(l,2),f=m[0],d=m[1],p=Object(a.useState)(t[0]||""),b=Object(s.a)(p,2),k=b[0],v=b[1],E=Object(a.useState)(""),g=Object(s.a)(E,2),j=g[0],y=g[1],w=Object(a.useState)(M[Math.floor(Math.random()*M.length)]),N=Object(s.a)(w,2),T=N[0],C=N[1],P=k?n[k]:T,_=h(),R=Object(s.a)(_,2),I=R[0],D=R[1];Object(a.useEffect)((function(){0===t.length&&v("")}),[t.length]);var x=function(e){return r.a.createElement("button",{className:"confirm",disabled:!f||!(k||j)},e)};return r.a.createElement("form",{className:"task",onSubmit:function(e){e.preventDefault(),u.a.post("".concat(O,"/tasks/"),{name:f,project:k||j,color:P,seconds:0,timestamp:Date.now()}).then(c).catch((function(e){e.response&&403===e.response.status?D("The task already exists!"):(D("Error connecting with the server."),console.error(e))}))},style:{"--task-color":P}},i?r.a.createElement("div",{className:"first-time-notice"},"Start by creating a task. Just anything you're working on."):"",r.a.createElement("div",{className:"task-head"},r.a.createElement(S,{seconds:0},x(r.a.createElement("img",{src:"".concat("/react-time-tracker","/baseline_add_white_24dp.png"),alt:"Create task",title:"Create task"})))),r.a.createElement("div",{className:"task-body"},r.a.createElement("h3",null,r.a.createElement("input",{type:"text",id:"task-name",placeholder:"Task name",value:f,onChange:A(d)})),t.length?r.a.createElement(r.a.Fragment,null,r.a.createElement("select",{id:"project-name",value:k,onChange:A(v)},t.map((function(e){return r.a.createElement("option",{key:e,value:e,style:{"--task-color":n[e]}},e)})),r.a.createElement("option",{value:"",style:{"--task-color":T,fontStyle:"italic"}},"New project")),r.a.createElement("br",null)):"",""!==k&&t.length?"":r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{type:"text",id:"new-project-name",placeholder:"Project name",value:j,onChange:A(y)}),r.a.createElement("input",{type:"color",id:"new-project-color",value:T,onChange:A(C)})),I),r.a.createElement("div",{className:"task-foot"},x("Create task"),r.a.createElement("button",{className:"cancel",onClick:o},"Cancel")))};function L(e){var t=e.projects,n=e.projectColors,c=e.updateTasks,o=Object(a.useState)(!Boolean(localStorage.getItem("hasCreatedATask"))),i=Object(s.a)(o,2),l=i[0],u=i[1],m=Object(a.useState)(l),f=Object(s.a)(m,2),d=f[0],p=f[1];Object(a.useEffect)((function(){!1===l&&localStorage.setItem("hasCreatedATask","1")}),[l]);var b=t?t.length:null;return Object(a.useEffect)((function(){0===b?p(!0):null!==b&&b>0&&u(!1)}),[b]),d&&t?r.a.createElement(U,{projects:t,projectColors:n,onCreate:function(){u(!1),p(!1),c()},onCancel:function(){return p(!1)},isFirstTime:l}):r.a.createElement("button",{className:"task task-head new-task",onClick:function(){return p(!0)}},"New task")}var J=function(e){return function(t){return e(t.target.value)}};var F=function(e){var t=e.searchQuery,n=e.setSearchQuery,c=Object(a.useRef)(null);return Object(a.useEffect)((function(){function e(e){"Escape"===e.key&&(n(""),c&&c.current.focus())}return window.addEventListener("keydown",e),function(){return window.removeEventListener("keydown",e)}}),[n]),Object(a.useEffect)((function(){c&&c.current.focus()}),[t]),r.a.createElement("div",{className:"search-bar"},r.a.createElement("img",{src:"".concat("/react-time-tracker","/baseline_search_black_18dp.png"),alt:"",onClick:function(){c.current&&c.current.focus()}}),r.a.createElement("input",{type:"text",value:t,onChange:J(n),ref:c}),r.a.createElement("img",{src:"".concat("/react-time-tracker","/baseline_close_black_18dp.png"),alt:"",style:{right:"2px"},onClick:function(){n("")}}))};var B=function(){var e=Object(a.useState)(Boolean(localStorage.getItem("understood-local-storage-notice"))),t=Object(s.a)(e,2),n=t[0],c=t[1];return Object(a.useEffect)((function(){n&&localStorage.setItem("understood-local-storage-notice","1")}),[n]),void 0!==Object({NODE_ENV:"production",PUBLIC_URL:"/react-time-tracker"}).REACT_APP_API?r.a.createElement(r.a.Fragment,null):n?r.a.createElement(r.a.Fragment,null):r.a.createElement("div",{className:"local-storage-notice"},r.a.createElement("div",null,"This site uses both ",r.a.createElement("b",null,"cookies")," and ",r.a.createElement("b",null,"localStorage")," to store your user data (it should be safe unless you decide to clear your cache). Any data you provide is saved on your current browser and device ",r.a.createElement("i",null,"only"),". The server doesn't store any data whatsoever, so you're adviced to keep regular backups using the Export function."),r.a.createElement("button",{onClick:function(){return c(!0)}},"I understand"))};var q=function(e){var t=e.updateTasks,n=e.setErrorMessage;return r.a.createElement("button",{className:"import-tasks",onClick:function(){var e=document.createElement("input");function a(e){var a=e.target.result;if(a&&a.length){var r;try{r=JSON.parse(a)}catch(c){return void n("The file is invalid or corrupted.")}u.a.post("".concat(O,"/import-tasks/"),r).then((function(e){t()})).catch((function(e){e.response?n("There was an error importing tasks."):n("There was an error connecting to the server.")}))}}e.type="file",e.accept=".json",e.click(),e.addEventListener("change",(function(){if(e.files.length){var t=new FileReader,n=e.files[0];t.readAsText(n),t.addEventListener("load",a)}}))}},"Import")};var V=function(e){var t=e.tasks;return r.a.createElement("button",{className:"export-tasks",onClick:function(){var e=document.createElement("a");e.setAttribute("href","data:text/plain;charset=utf-u,"+encodeURIComponent(JSON.stringify(t))),e.setAttribute("download","Tasks backup.json"),e.click()}},"Export")};var Q=function(e){var t=e.tasks,n=e.updateTasks,a=e.setErrorMessage;return r.a.createElement("div",{className:"button-bar task"},r.a.createElement(q,{updateTasks:n,setErrorMessage:a}),r.a.createElement(V,{tasks:t}))};var K=function(){var e=Object(a.useState)(""),t=Object(s.a)(e,2),n=t[0],c=t[1],o=h(),i=Object(s.a)(o,2),l=i[0],m=i[1],f=function(e,t){var n=b(),r=Object(a.useState)(null),c=Object(s.a)(r,2),o=c[0],i=c[1],l=Object(a.useState)(0),m=Object(s.a)(l,2),f=m[0],d=m[1];if(Object(a.useEffect)((function(){u.a.get("".concat(O,"/tasks/")).then((function(e){n||i(e.data)})).catch((function(e){n||(e.response?t("The server responded with an error."):(t("Error connecting with the server. Please reload the tab."),console.error(e)))}))}),[n,f,t]),null!==o&&(o=o.sort((function(e,t){return t.timestamp-e.timestamp})),e.length)){var p=e.trim().toLowerCase().replace(/\s+/g," ").split(" ");p.length&&(o=o.filter((function(e){return p.every((function(t){return e.name.toLowerCase().includes(t)||e.project.toLowerCase().includes(t)}))})))}return[o,function(e){e&&i(e(o)),d(f+1)}]}(n,m),p=Object(s.a)(f,2),k=p[0],v=p[1],E=function(e){if(null===e)return[];var t=Object.create(null);return[e.reduce((function(e,n){return e.includes(n.project)?e:(t[n.project]=n.color,[].concat(Object(d.a)(e),[n.project]))}),[]),t]}(k),g=Object(s.a)(E,2),j=g[0],y=g[1];return r.a.createElement("div",{className:"task-container"},r.a.createElement(F,{searchQuery:n,setSearchQuery:c}),r.a.createElement(Q,{tasks:k,updateTasks:v,setErrorMessage:m}),r.a.createElement(L,{projects:j,projectColors:y,updateTasks:v}),r.a.createElement("div",{style:{clear:"both"}}),l,null!==k?k.map((function(e){return r.a.createElement(x,{key:"".concat(e.project,"/").concat(e.name),task:e,selectProject:c,updateTasks:v,tasks:k})})):"",r.a.createElement("div",{style:{clear:"both"}}),r.a.createElement("div",{className:"footer task"},r.a.createElement(B,null),r.a.createElement("br",null),"Mauro Cano Brusa (c) 2019."," ",r.a.createElement("a",{href:"https://github.com/mauroc8/react-time-tracker"},"View source"),"."))};n(57);o.a.render(r.a.createElement(K,null),document.getElementById("root"))}},[[23,1,2]]]);
//# sourceMappingURL=main.fd9cf282.chunk.js.map